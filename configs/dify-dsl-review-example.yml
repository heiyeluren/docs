app:
  description: æ™ºèƒ½å†…å®¹å®¡æ ¸ä¸å®¢æœå›å¤ç³»ç»Ÿï¼Œè‡ªåŠ¨æ£€æµ‹æ•æ„Ÿå†…å®¹å¹¶æä¾›ä¸“ä¸šå®¢æœå›å¤
  icon: ğŸ›¡ï¸
  icon_background: '#E3F2FD'
  mode: workflow
  name: å®¢æœå†…å®¹å¤„ç†ç³»ç»Ÿ
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openrouter:0.0.8@c6508dfd6c5c6e7aa0c185df370b07fd093001df42xxxxxxxxxxxxxxxxxxxxx
kind: app
version: 0.1.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      enabled: false
    opening_statement: ''
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
  graph:
    edges:
    - data:
        isInIteration: false
        sourceType: start
        targetType: llm
      id: start-content-detector
      source: start
      sourceHandle: source
      target: content-detector
      targetHandle: target
      type: custom
    - data:
        isInIteration: false
        sourceType: llm
        targetType: if-else
      id: content-detector-sensitive-check
      source: content-detector
      sourceHandle: source
      target: sensitive-check
      targetHandle: target
      type: custom
    - data:
        isInIteration: false
        sourceType: if-else
        targetType: llm
      id: sensitive-check-sensitive-classifier
      source: sensitive-check
      sourceHandle: 'true'
      target: sensitive-classifier
      targetHandle: target
      type: custom
    - data:
        isInIteration: false
        sourceType: if-else
        targetType: llm
      id: sensitive-check-service-classifier
      source: sensitive-check
      sourceHandle: 'false'
      target: service-classifier
      targetHandle: target
      type: custom
    - data:
        isInIteration: false
        sourceType: llm
        targetType: end
      id: sensitive-classifier-violation-end
      source: sensitive-classifier
      sourceHandle: source
      target: violation-end
      targetHandle: target
      type: custom
    - data:
        isInIteration: false
        sourceType: llm
        targetType: llm
      id: service-classifier-reply-generator
      source: service-classifier
      sourceHandle: source
      target: reply-generator
      targetHandle: target
      type: custom
    - data:
        isInIteration: false
        sourceType: llm
        targetType: end
      id: reply-generator-service-end
      source: reply-generator
      sourceHandle: source
      target: service-end
      targetHandle: target
      type: custom
    nodes:
    - data:
        desc: å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬å†…å®¹
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - label: ç”¨æˆ·è¾“å…¥å†…å®¹
          max_length: 2000
          required: true
          type: text-input
          variable: user_content
        - label: ç”¨æˆ·ID
          max_length: 100
          required: false
          type: text-input
          variable: user_id
        - label: æ¸ é“æ¥æº
          max_length: 50
          required: false
          type: text-input
          variable: channel_source
      height: 200
      id: start
      position:
        x: 30
        y: 300
      positionAbsolute:
        x: 30
        y: 300
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: æ£€æµ‹ç”¨æˆ·è¾“å…¥å†…å®¹æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯
        model:
          completion_params:
            temperature: 0.1
          mode: chat
          name: openai/gpt-4o-mini
          provider: langgenius/openrouter/openrouter
        prompt_template:
        - id: detector-system-prompt
          role: system
          text: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å†…å®¹å®‰å…¨å®¡æ ¸ä¸“å®¶ï¼Œè´Ÿè´£æ£€æµ‹æ–‡æœ¬ä¸­çš„æ•æ„Ÿå†…å®¹ã€‚

            ## æ£€æµ‹èŒƒå›´

            è¯·æ£€æµ‹ä»¥ä¸‹ç±»å‹çš„æ•æ„Ÿå†…å®¹ï¼š
            1. **æ”¿æ²»æ•æ„Ÿå†…å®¹** - æ¶‰åŠæ”¿æ²»æ•æ„Ÿè¯é¢˜ã€æ”¿æ²»äººç‰©æ”»å‡»ç­‰
            2. **è‰²æƒ…æš´åŠ›å†…å®¹** - åŒ…å«è‰²æƒ…ã€æš´åŠ›ã€è¡€è…¥ç­‰ä¸å½“å†…å®¹
            3. **è¿æ³•è¿è§„å†…å®¹** - æ¶‰åŠè¿æ³•çŠ¯ç½ªã€æ¬ºè¯ˆã€èµŒåšç­‰è¿æ³•è¡Œä¸º
            4. **æ¶æ„æ”»å‡»å†…å®¹** - äººèº«æ”»å‡»ã€æ­§è§†ã€ä»‡æ¨è¨€è®ºç­‰
            5. **åƒåœ¾å¹¿å‘Šå†…å®¹** - æ¶æ„è¥é”€ã€åƒåœ¾å¹¿å‘Šã€è¯ˆéª—ä¿¡æ¯ç­‰
            6. **å…¶ä»–æœ‰å®³å†…å®¹** - è‡ªæ®‹ã€æç«¯æ€æƒ³ç­‰æœ‰å®³ä¿¡æ¯

            ## è¾“å‡ºè¦æ±‚

            è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼Œåªè¾“å‡ºæ£€æµ‹ç»“æœï¼š
            å®‰å…¨|æ•æ„Ÿ'
        - id: detector-user-prompt
          role: user
          text: 'è¯·æ£€æµ‹ä»¥ä¸‹å†…å®¹æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼š

            **ç”¨æˆ·å†…å®¹ï¼š**{{#start.user_content#}}

            **æ¸ é“æ¥æºï¼š**{{#start.channel_source#}}

            è¯·ä»”ç»†åˆ†æå†…å®¹ï¼Œåˆ¤æ–­æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œåªè¾“å‡º"å®‰å…¨"æˆ–"æ•æ„Ÿ"ã€‚'
        selected: false
        title: æ•æ„Ÿå†…å®¹æ£€æµ‹
        type: llm
        variables: []
        vision:
          enabled: false
      height: 134
      id: content-detector
      position:
        x: 334
        y: 300
      positionAbsolute:
        x: 334
        y: 300
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: contains
            id: sensitive-condition
            value: æ•æ„Ÿ
            variable_selector:
            - content-detector
            - text
          id: 'true'
          logical_operator: and
        desc: åˆ¤æ–­å†…å®¹æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå†³å®šåç»­å¤„ç†æµç¨‹
        logical_operator: and
        selected: false
        title: æ•æ„Ÿå†…å®¹åˆ¤æ–­
        type: if-else
      height: 170
      id: sensitive-check
      position:
        x: 638
        y: 300
      positionAbsolute:
        x: 638
        y: 300
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: å¯¹æ£€æµ‹åˆ°çš„æ•æ„Ÿå†…å®¹è¿›è¡Œè¯¦ç»†åˆ†ç±»å¹¶è¾“å‡ºè¿è§„æç¤º
        model:
          completion_params:
            temperature: 0.1
          mode: chat
          name: openai/gpt-4o-mini
          provider: langgenius/openrouter/openrouter
        prompt_template:
        - id: sensitive-system-prompt
          role: system
          text: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ•æ„Ÿå†…å®¹åˆ†ç±»ä¸“å®¶ï¼Œè´Ÿè´£å¯¹æ•æ„Ÿå†…å®¹è¿›è¡Œè¯¦ç»†åˆ†ç±»ã€‚

            ## åˆ†ç±»æ ‡å‡†

            è¯·å°†æ•æ„Ÿå†…å®¹åˆ†ç±»ä¸ºä»¥ä¸‹ç±»å‹ï¼š
            1. **æ”¿æ²»æ•æ„Ÿ** - æ¶‰åŠæ”¿æ²»æ•æ„Ÿè¯é¢˜
            2. **è‰²æƒ…æš´åŠ›** - åŒ…å«ä¸å½“å†…å®¹
            3. **è¿æ³•è¿è§„** - æ¶‰åŠè¿æ³•è¡Œä¸º
            4. **æ¶æ„æ”»å‡»** - äººèº«æ”»å‡»è¨€è®º
            5. **åƒåœ¾å¹¿å‘Š** - æ¶æ„è¥é”€ä¿¡æ¯
            6. **å…¶ä»–æœ‰å®³** - å…¶ä»–æœ‰å®³ä¿¡æ¯

            ## è¾“å‡ºæ ¼å¼

            è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼š

            {
              "violation_type": "å…·ä½“è¿è§„ç±»å‹",
              "violation_detail": "è¯¦ç»†è¿è§„è¯´æ˜",
              "risk_level": "é«˜é£é™©|ä¸­é£é™©|ä½é£é™©",
              "system_response": "å¾ˆæŠ±æ­‰ï¼Œæ‚¨çš„å†…å®¹åŒ…å«ä¸å½“ä¿¡æ¯ï¼Œæ— æ³•ä¸ºæ‚¨æä¾›æœåŠ¡ã€‚è¯·éµå®ˆå¹³å°ä½¿ç”¨è§„èŒƒã€‚",
              "processing_time": "2024-12-29 18:30:00",
              "user_id": "ç”¨æˆ·ID",
              "channel_source": "æ¸ é“æ¥æº"
            }'
        - id: sensitive-user-prompt
          role: user
          text: 'è¯·å¯¹ä»¥ä¸‹æ•æ„Ÿå†…å®¹è¿›è¡Œè¯¦ç»†åˆ†ç±»ï¼š

            **ç”¨æˆ·å†…å®¹ï¼š**{{#start.user_content#}}

            **ç”¨æˆ·IDï¼š**{{#start.user_id#}}

            **æ¸ é“æ¥æºï¼š**{{#start.channel_source#}}

            **æ£€æµ‹ç»“æœï¼š**{{#content-detector.text#}}

            è¯·åˆ†ææ•æ„Ÿå†…å®¹ç±»å‹ï¼Œè®¾ç½®é£é™©ç­‰çº§ï¼Œå¹¶ç”Ÿæˆç³»ç»Ÿå›å¤ï¼Œåªè¾“å‡ºJSONæ ¼å¼ç»“æœã€‚'
        selected: false
        title: æ•æ„Ÿå†…å®¹åˆ†ç±»
        type: llm
        variables: []
        vision:
          enabled: false
      height: 134
      id: sensitive-classifier
      position:
        x: 942
        y: 150
      positionAbsolute:
        x: 942
        y: 150
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: å¯¹æ­£å¸¸å†…å®¹è¿›è¡Œå®¢æœé—®é¢˜åˆ†ç±»
        model:
          completion_params:
            temperature: 0.2
          mode: chat
          name: openai/gpt-4o-mini
          provider: langgenius/openrouter/openrouter
        prompt_template:
        - id: service-system-prompt
          role: system
          text: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å®¢æœé—®é¢˜åˆ†ç±»ä¸“å®¶ï¼Œè´Ÿè´£å¯¹ç”¨æˆ·å’¨è¯¢è¿›è¡Œå‡†ç¡®åˆ†ç±»ã€‚

            ## åˆ†ç±»æ ‡å‡†

            è¯·å°†ç”¨æˆ·é—®é¢˜åˆ†ç±»ä¸ºä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š
            1. **äº§å“å’¨è¯¢** - å…³äºäº§å“åŠŸèƒ½ã€ç‰¹æ€§ã€ä½¿ç”¨æ–¹æ³•çš„å’¨è¯¢
            2. **æŠ€æœ¯æ”¯æŒ** - æŠ€æœ¯é—®é¢˜ã€æ•…éšœæŠ¥å‘Šã€ä½¿ç”¨å›°éš¾ç­‰
            3. **è´¦æˆ·é—®é¢˜** - ç™»å½•ã€æ³¨å†Œã€å¯†ç ã€ä¸ªäººä¿¡æ¯ç›¸å…³
            4. **è®¢å•ç›¸å…³** - è´­ä¹°ã€æ”¯ä»˜ã€é€€æ¬¾ã€å‘è´§ç­‰è®¢å•é—®é¢˜
            5. **æŠ•è¯‰å»ºè®®** - æ„è§åé¦ˆã€æŠ•è¯‰ã€æ”¹è¿›å»ºè®®ç­‰
            6. **å…¶ä»–å’¨è¯¢** - ä¸å±äºä»¥ä¸Šåˆ†ç±»çš„å…¶ä»–é—®é¢˜

            ## è¾“å‡ºæ ¼å¼

            è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºåˆ†ç±»ç»“æœï¼š
            äº§å“å’¨è¯¢|æŠ€æœ¯æ”¯æŒ|è´¦æˆ·é—®é¢˜|è®¢å•ç›¸å…³|æŠ•è¯‰å»ºè®®|å…¶ä»–å’¨è¯¢'
        - id: service-user-prompt
          role: user
          text: 'è¯·å¯¹ä»¥ä¸‹ç”¨æˆ·é—®é¢˜è¿›è¡Œåˆ†ç±»ï¼š

            **ç”¨æˆ·å†…å®¹ï¼š**{{#start.user_content#}}

            **ç”¨æˆ·IDï¼š**{{#start.user_id#}}

            **æ¸ é“æ¥æºï¼š**{{#start.channel_source#}}

            è¯·åˆ†æç”¨æˆ·é—®é¢˜çš„æ ¸å¿ƒéœ€æ±‚ï¼Œé€‰æ‹©æœ€åˆé€‚çš„åˆ†ç±»ï¼Œåªè¾“å‡ºåˆ†ç±»ç»“æœã€‚'
        selected: false
        title: å®¢æœé—®é¢˜åˆ†ç±»
        type: llm
        variables: []
        vision:
          enabled: false
      height: 134
      id: service-classifier
      position:
        x: 942
        y: 450
      positionAbsolute:
        x: 942
        y: 450
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: æ ¹æ®é—®é¢˜åˆ†ç±»ç”Ÿæˆä¸“ä¸šçš„å®¢æœå›å¤
        model:
          completion_params:
            temperature: 0.3
          mode: chat
          name: openai/gpt-4o-mini
          provider: langgenius/openrouter/openrouter
        prompt_template:
        - id: reply-system-prompt
          role: system
          text: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å®¢æœå›å¤ç”Ÿæˆä¸“å®¶ï¼Œè´Ÿè´£æ ¹æ®é—®é¢˜åˆ†ç±»ç”Ÿæˆåˆé€‚çš„å®¢æœå›å¤ã€‚

            ## å›å¤åŸåˆ™

            1. **ä¸“ä¸šæ€§** - å›å¤å†…å®¹ä¸“ä¸šã€å‡†ç¡®ã€æœ‰å¸®åŠ©
            2. **å‹å¥½æ€§** - è¯­æ°”äº²å’Œã€ç¤¼è²Œã€ä½“ç°å…³æ€€
            3. **é’ˆå¯¹æ€§** - æ ¹æ®é—®é¢˜ç±»å‹æä¾›é’ˆå¯¹æ€§è§£å†³æ–¹æ¡ˆ
            4. **å®Œæ•´æ€§** - å›å¤åŒ…å«é—®é¢˜è§£ç­”å’Œåç»­æŒ‡å¼•

            ## å›å¤é£æ ¼

            - ä½¿ç”¨ç¤¼è²Œã€ä¸“ä¸šçš„è¯­è¨€
            - ä½“ç°å¯¹ç”¨æˆ·çš„ç†è§£å’Œå…³æ€€
            - æä¾›å…·ä½“çš„è§£å†³æ–¹æ¡ˆæˆ–æŒ‡å¼•
            - å¿…è¦æ—¶æä¾›è”ç³»æ–¹å¼æˆ–åç»­æ­¥éª¤

            ## è¾“å‡ºæ ¼å¼

            è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼š

            {
              "question_type": "é—®é¢˜åˆ†ç±»",
              "reply_content": "è¯¦ç»†çš„å®¢æœå›å¤å†…å®¹",
              "priority_level": "é«˜|ä¸­|ä½",
              "follow_up_action": "åç»­å¤„ç†å»ºè®®",
              "estimated_resolution_time": "é¢„è®¡å¤„ç†æ—¶é—´",
              "contact_info": "è”ç³»æ–¹å¼æˆ–ç›¸å…³é“¾æ¥",
              "processing_time": "2024-12-29 18:30:00",
              "user_id": "ç”¨æˆ·ID",
              "channel_source": "æ¸ é“æ¥æº"
            }'
        - id: reply-user-prompt
          role: user
          text: 'è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆä¸“ä¸šçš„å®¢æœå›å¤ï¼š

            **ç”¨æˆ·å†…å®¹ï¼š**{{#start.user_content#}}

            **ç”¨æˆ·IDï¼š**{{#start.user_id#}}

            **æ¸ é“æ¥æºï¼š**{{#start.channel_source#}}

            **é—®é¢˜åˆ†ç±»ï¼š**{{#service-classifier.text#}}

            è¯·æ ¹æ®é—®é¢˜åˆ†ç±»ç”Ÿæˆä¸“ä¸šã€å‹å¥½ã€æœ‰å¸®åŠ©çš„å®¢æœå›å¤ï¼Œåªè¾“å‡ºJSONæ ¼å¼ç»“æœã€‚'
        selected: false
        title: æ™ºèƒ½å›å¤ç”Ÿæˆ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 134
      id: reply-generator
      position:
        x: 1246
        y: 450
      positionAbsolute:
        x: 1246
        y: 450
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: æ•æ„Ÿå†…å®¹å¤„ç†ç»“æŸèŠ‚ç‚¹ï¼Œè¾“å‡ºè¿è§„å¤„ç†ç»“æœ
        outputs:
        - value_selector:
          - sensitive-classifier
          - text
          variable: violation_result
        selected: false
        title: è¿è§„å¤„ç†ç»“æŸ
        type: end
      height: 134
      id: violation-end
      position:
        x: 1246
        y: 150
      positionAbsolute:
        x: 1246
        y: 150
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: å®¢æœå›å¤å¤„ç†ç»“æŸèŠ‚ç‚¹ï¼Œè¾“å‡ºå®¢æœå›å¤ç»“æœ
        outputs:
        - value_selector:
          - reply-generator
          - text
          variable: service_reply
        selected: false
        title: å®¢æœå›å¤ç»“æŸ
        type: end
      height: 134
      id: service-end
      position:
        x: 1550
        y: 450
      positionAbsolute:
        x: 1550
        y: 450
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: 100
      y: -50
      zoom: 0.8
